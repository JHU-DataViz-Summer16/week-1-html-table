<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Week 2: JS DOM Tables</title><!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link type="text/css" rel="stylesheet" href="stylesheet.css"/>
<!--   <style>
    .header {
      text-align: center;
    }
  </style> -->
</head>

<body>
<div class="header section">
  <div class="container">
    <h1>Week 2: Javascript and the DOM</h1>
    <p>This table shows employees on nonfarm payrolls by state, in thousands, for March 2016.</p>
  </div>
</div>
<div class="controls section">
  <div class="container">
    <div class="btn-toolbar">
      <div class="btn-group">
        <button type="button" class="btn btn-default" id="sort-asc">Ascending</button>
        <button type="button" class="btn btn-default" id="sort-desc">Descending</button>
      </div>
      <div class="btn-group">
        <button type="button" class="btn btn-default" id="filter-ne">Northeast</button>
        <button type="button" class="btn btn-default" id="filter-so">South</button>
        <button type="button" class="btn btn-default" id="filter-mw">Midwest</button>
        <button type="button" class="btn btn-default" id="filter-we">West</button>
      </div>
    </div>
  </div>
</div>
<div class="main section">
  <div class="container">
    <table class="table" id="data-table">
      <thead>
        <tr>
          <th>State</th>
          <th>Employment</th>
          <th>Region</th>
          <th>Chart</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <nav>
      <ul class="pager">
        <li class="previous"><a href="#" id="page-prev">Previous</a></li>
        <li class="next"><a href="#" id="page-next">Next</a></li>
      </ul>
    </nav>
  </div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script>
  var states = [
{"State":"Alabama","Employment":1959.0,"Region":"South"},
{"State":"Alaska","Employment":338.4,"Region":"West"},
{"State":"Arizona","Employment":2691.9,"Region":"West"},
{"State":"Arkansas","Employment":1224.4,"Region":"South"},
{"State":"California","Employment":16321.9,"Region":"West"},
{"State":"Colorado","Employment":2595.8,"Region":"West"},
{"State":"Connecticut","Employment":1686.3,"Region":"Northeast"},
{"State":"Delaware","Employment":458.6,"Region":"South"},
{"State":"District of Columbia","Employment":773.8,"Region":"South"},
{"State":"Florida","Employment":8252.8,"Region":"South"},
{"State":"Georgia","Employment":4360.7,"Region":"South"},
{"State":"Hawaii","Employment":651.4,"Region":"West"},
{"State":"Idaho","Employment":691.7,"Region":"West"},
{"State":"Illinois","Employment":6006.7,"Region":"Midwest"},
{"State":"Indiana","Employment":3062.1,"Region":"Midwest"},
{"State":"Iowa","Employment":1576.5,"Region":"Midwest"},
{"State":"Kansas","Employment":1399.2,"Region":"Midwest"},
{"State":"Kentucky","Employment":1908.9,"Region":"South"},
{"State":"Louisiana","Employment":1977.1,"Region":"South"},
{"State":"Maine","Employment":614.6,"Region":"Northeast"},
{"State":"Maryland","Employment":2704.6,"Region":"South"},
{"State":"Massachusetts","Employment":3537.1,"Region":"Northeast"},
{"State":"Michigan","Employment":4324.9,"Region":"Midwest"},
{"State":"Minnesota","Employment":2876.2,"Region":"Midwest"},
{"State":"Mississippi","Employment":1147.1,"Region":"South"},
{"State":"Missouri","Employment":2801.2,"Region":"Midwest"},
{"State":"Montana","Employment":464.6,"Region":"West"},
{"State":"Nebraska","Employment":1017.3,"Region":"Midwest"},
{"State":"Nevada","Employment":1282.7,"Region":"West"},
{"State":"New Hampshire","Employment":664.9,"Region":"Northeast"},
{"State":"New Jersey","Employment":4073.9,"Region":"Northeast"},
{"State":"New Mexico","Employment":827.6,"Region":"West"},
{"State":"New York","Employment":9332.9,"Region":"Northeast"},
{"State":"North Carolina","Employment":4310.5,"Region":"South"},
{"State":"North Dakota","Employment":440.0,"Region":"Midwest"},
{"State":"Ohio","Employment":5491.4,"Region":"Midwest"},
{"State":"Oklahoma","Employment":1666.0,"Region":"South"},
{"State":"Oregon","Employment":1823.2,"Region":"West"},
{"State":"Pennsylvania","Employment":5894.6,"Region":"Northeast"},
{"State":"Rhode Island","Employment":490.6,"Region":"Northeast"},
{"State":"South Carolina","Employment":2039.6,"Region":"South"},
{"State":"South Dakota","Employment":432.3,"Region":"Midwest"},
{"State":"Tennessee","Employment":2951.7,"Region":"South"},
{"State":"Texas","Employment":11961.6,"Region":"South"},
{"State":"Utah","Employment":1411.7,"Region":"West"},
{"State":"Vermont","Employment":316.5,"Region":"Northeast"},
{"State":"Virginia","Employment":3919.1,"Region":"South"},
{"State":"Washington","Employment":3230.5,"Region":"West"},
{"State":"West Virginia","Employment":761.8,"Region":"South"},
{"State":"Wisconsin","Employment":2936.2,"Region":"Midwest"},
{"State":"Wyoming","Employment":284.4,"Region":"West"}
  ];

  // The ALL_CAPS treatment here is signalling that this variable is a constant - it should never change.
  var MAX_EMPLOYMENT = 16321.9;

  // This is where we'll store the data representing user interaction; event handlers (the functions that
  // are called when a user clicks a button) work by updating the properties of this object. An alternative
  // approach, where each event handler directly updates the table, would quickly become messy. Imagine,
  // for example, that I've filtered the table to just show elementary schools. Next, I sort the table to
  // be in descending order. Finally, I unfilter the table to show all schools. If I'm not careful, the
  // newly revealed schools will not be sorted, because the filter operation doesn't know how to sort.
  // Instead, updateTable() will sort, filter, and paginate based on whatever the options object contains,
  // always starting from a fresh copy of the data, and we can count on the result to be consistent
  // given the same values in options.
  var options = {
    sorted: false,
    filtered: false,
    page: 0
  };

  function updateTable() {
    // Make a copy of the data
    var data = states.slice();

    // Sort schools by enrollment
    if (options.sorted) {
      if (options.sorted === 'asc') {
        data.sort(function (a, b) { return a.employment - b.employment; });
        // This anonymous function is responsible for comparing two values a and b. If it returns a positive
        // number, we're saying that a should come after b in the array. A negative number means that b
        // should come after a. A zero means that the two are equal. This function is using the 'enrollment'
        // property of each observation of data for this comparison. You'll need to change 'enrollment' to
        // whatever property you want to sort your data on.
        //
        // Also, note that we're sorting the data in place, changing, or mutating, the 'data' variable. See
        // the note in the README about how this compares to the filter() and slice() operations that we'll
        // use for the next two data transforms.
      } else if (options.sorted === 'desc') {
        data.sort(function (a, b) { return b.employment - a.employment; });
        // Note that this is just the opposite of the above.
      }
    }

    // Filter schools by grade level

    // Select only the schools from the current page (slice)

 /*   var table = document.getElementById('data-table');
    var tbody = table.getElementsByTagName('tbody')[0];
    // Because getElementsByTagName returns an array of DOM nodes (technically, it's an HTMLCollection),
    // we need to select the first item in the array with the [0].

    // Remove any existing rows
    tbody.innerHTML = '';

    // Add a new row for each datum (item in the 'data' array)
    data.forEach(function (d) {
      var row = document.createElement('tr');
      // This is like create a new <tr></tr> in HTML, but it doesn't yet exist in the DOM, so we can't
      // see it. At the bottom of this forEach() loop, we append it to an element that is in the DOM,
      // at which point it appears. We'll follow this same pattern for each of the <td></td> elements
      // we create below.

      var school = document.createElement('td');
      school.innerHTML = d.name;
      row.appendChild(school);  

      var level = document.createElement('td');
      level.innerHTML = d.level_text;
      row.appendChild(level);

      var enrollment = document.createElement('td');
      enrollment.innerHTML = d.enrollment + ' students';
      row.appendChild(enrollment);

      var barWrapper = document.createElement('td');
      var bar = document.createElement('div');
      bar.setAttribute('class', 'bar');
      // We set the class to 'bar' so we can use the .bar class we have in our styles. This gives it a
      // consistent height and a color.
      var enrollmentPercentage = d.enrollment / MAX_ENROLLMENT;
      bar.setAttribute('style', 'width: ' + (enrollmentPercentage * 100) + '%;');
      // I've broken this operation up into two steps, which is a little different than we did in class.
      // The end result is the same, though. If 'enrollmentPercentage' equals 0.75, this set the style
      // attribute of our DIV so that it looks something like <div style="width: 75%;"></div>
      barWrapper.appendChild(bar);
      row.appendChild(barWrapper);

      tbody.appendChild(row);
    });
  }

  // The function declaration above just creates the function, it doesn't yet run it. That's what we
  // do here, to make sure that the table is populated prior to the user clicking anything.
  updateTable();

  // This is creating an event listener, a function that the browser will call every time the specified
  // event is "fired" by the selected element (here the button with the id 'sort-asc').
  document.getElementById('sort-asc').addEventListener('click', function () {
    // Disable the sort if 'asc' was previously selected, otherwise set the sort to 'asc'
    if (options.sorted === 'asc') {
      options.sorted = false;
    } else {
      options.sorted = 'asc';
    }

    // And now we need to re-run the function that populates the table. Note that the results will be
    // different because we've change the options object.
    updateTable();
  });

  document.getElementById('sort-desc').addEventListener('click', function () {
    // Disable the sort if 'desc' was previously selected, otherwise set the sort to 'desc'
    if (options.sorted === 'desc') {
      options.sorted = false;
    } else {
      options.sorted = 'desc';
    }

    updateTable();
  });*/

  // This is where we'll need to create new event listeners for our filter and next/previous page buttons.
  // They'll look very similar to the above, just listening to different elements, and perhaps performing
  // different actions when clicked.
</script>




  <p>Source: <a href="http://www.bls.gov/home.htm">Bureau of Labor Statistics</a></p>
</body>
</html>
