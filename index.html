<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Week 2: JS DOM Tables</title><!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link type="text/css" rel="stylesheet" href="stylesheet.css"/>
<!--   <style>
    .header {
      text-align: center;
    }
  </style> -->
</head>

<body>
<div class="header section">
  <div class="container">
    <h1>Week 2: Javascript and the DOM</h1>
    <p>This table shows the total number of employees on nonfarm payrolls by state, in thousands, for March 2016.</p>
  </div>
</div>
<div class="controls section">
  <div class="container">
    <div class="btn-toolbar">
      <div class="btn-group">
        <button type="button" class="btn btn-default" id="sort-asc">Ascending</button>
        <button type="button" class="btn btn-default" id="sort-desc">Descending</button>
      </div>
      <div class="btn-group">
        <button type="button" class="btn btn-default" id="filter-ne">Northeast</button>
        <button type="button" class="btn btn-default" id="filter-so">South</button>
        <button type="button" class="btn btn-default" id="filter-mw">Midwest</button>
        <button type="button" class="btn btn-default" id="filter-we">West</button>
      </div>
    </div>
  </div>
</div>
<div class="main section">
  <div class="container">
    <table class="table" id="data-table">
      <thead>
        <tr>
          <th>State</th>
          <th>Employees (thousands)</th>
          <th>Region</th>
          <th>Chart</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <nav>
      <ul class="pager">
        <li class="previous"><a href="#" id="page-prev">Previous</a></li>
        <li class="next"><a href="#" id="page-next">Next</a></li>
      </ul>
    </nav>
  </div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script>
  var states = [
	{"state":"Alabama","employment":1959.0,"region":"South"},
	{"state":"Alaska","employment":338.4,"region":"West"},
	{"state":"Arizona","employment":2691.9,"region":"West"},
	{"state":"Arkansas","employment":1224.4,"region":"South"},
	{"state":"California","employment":16321.9,"region":"West"},
	{"state":"Colorado","employment":2595.8,"region":"West"},
	{"state":"Connecticut","employment":1686.3,"region":"Northeast"},
	{"state":"Delaware","employment":458.6,"region":"South"},
	{"state":"District of Columbia","employment":773.8,"region":"South"},
	{"state":"Florida","employment":8252.8,"region":"South"},
	{"state":"Georgia","employment":4360.7,"region":"South"},
	{"state":"Hawaii","employment":651.4,"region":"West"},
	{"state":"Idaho","employment":691.7,"region":"West"},
	{"state":"Illinois","employment":6006.7,"region":"Midwest"},
	{"state":"Indiana","employment":3062.1,"region":"Midwest"},
	{"state":"Iowa","employment":1576.5,"region":"Midwest"},
	{"state":"Kansas","employment":1399.2,"region":"Midwest"},
	{"state":"Kentucky","employment":1908.9,"region":"South"},
	{"state":"Louisiana","employment":1977.1,"region":"South"},
	{"state":"Maine","employment":614.6,"region":"Northeast"},
	{"state":"Maryland","employment":2704.6,"region":"South"},
	{"state":"Massachusetts","employment":3537.1,"region":"Northeast"},
	{"state":"Michigan","employment":4324.9,"region":"Midwest"},
	{"state":"Minnesota","employment":2876.2,"region":"Midwest"},
	{"state":"Mississippi","employment":1147.1,"region":"South"},
	{"state":"Missouri","employment":2801.2,"region":"Midwest"},
	{"state":"Montana","employment":464.6,"region":"West"},
	{"state":"Nebraska","employment":1017.3,"region":"Midwest"},
	{"state":"Nevada","employment":1282.7,"region":"West"},
	{"state":"New Hampshire","employment":664.9,"region":"Northeast"},
	{"state":"New Jersey","employment":4073.9,"region":"Northeast"},
	{"state":"New Mexico","employment":827.6,"region":"West"},
	{"state":"New York","employment":9332.9,"region":"Northeast"},
	{"state":"North Carolina","employment":4310.5,"region":"South"},
	{"state":"North Dakota","employment":440.0,"region":"Midwest"},
	{"state":"Ohio","employment":5491.4,"region":"Midwest"},
	{"state":"Oklahoma","employment":1666.0,"region":"South"},
	{"state":"Oregon","employment":1823.2,"region":"West"},
	{"state":"Pennsylvania","employment":5894.6,"region":"Northeast"},
	{"state":"Rhode Island","employment":490.6,"region":"Northeast"},
	{"state":"South Carolina","employment":2039.6,"region":"South"},
	{"state":"South Dakota","employment":432.3,"region":"Midwest"},
	{"state":"Tennessee","employment":2951.7,"region":"South"},
	{"state":"Texas","employment":11961.6,"region":"South"},
	{"state":"Utah","employment":1411.7,"region":"West"},
	{"state":"Vermont","employment":316.5,"region":"Northeast"},
	{"state":"Virginia","employment":3919.1,"region":"South"},
	{"state":"Washington","employment":3230.5,"region":"West"},
	{"state":"West Virginia","employment":761.8,"region":"South"},
	{"state":"Wisconsin","employment":2936.2,"region":"Midwest"},
	{"state":"Wyoming","employment":284.4,"region":"West"}
  ];

  // The ALL_CAPS treatment here is signalling that this variable is a constant - it should never change.
  var MAX_EMPLOYMENT = 16322;

  // This is where we'll store the data representing user interaction; event handlers (the functions that
  // are called when a user clicks a button) work by updating the properties of this object. An alternative
  // approach, where each event handler directly updates the table, would quickly become messy. Imagine,
  // for example, that I've filtered the table to just show elementary schools. Next, I sort the table to
  // be in descending order. Finally, I unfilter the table to show all schools. If I'm not careful, the
  // newly revealed schools will not be sorted, because the filter operation doesn't know how to sort.
  // Instead, updateTable() will sort, filter, and paginate based on whatever the options object contains,
  // always starting from a fresh copy of the data, and we can count on the result to be consistent
  // given the same values in options.
  var options = {
    sorted: false,
    filtered: false,
    page: 0
  };

  function updateTable() {
    // Make a copy of the data
    var data = states.slice();

    // Sort schools by enrollment
    if (options.sorted) {
      if (options.sorted === 'asc') {
        data.sort(function (a, b) { return a.employment - b.employment; });
        // This anonymous function is responsible for comparing two values a and b. If it returns a positive
        // number, we're saying that a should come after b in the array. A negative number means that b
        // should come after a. A zero means that the two are equal. This function is using the 'enrollment'
        // property of each observation of data for this comparison. You'll need to change 'enrollment' to
        // whatever property you want to sort your data on.
        //
        // Also, note that we're sorting the data in place, changing, or mutating, the 'data' variable. See
        // the note in the README about how this compares to the filter() and slice() operations that we'll
        // use for the next two data transforms.
      } else if (options.sorted === 'desc') {
        data.sort(function (a, b) { return b.employment - a.employment; });
        // Note that this is just the opposite of the above.
      }


      if (options.filtered) {
      	if (options.filtered === 'northeast') {
      		data = data.filter(function (d) {	return d.region === "Northeast" })
        } else if (options.filtered === 'south') {
          data = data.filter(function (d) { return d.region === "South"})
        } else if (options.filtered === 'midwest') {
          data = data.filter(function (d) { return d.region === "Midwest"})
        } else if (options.filtered === 'west') {
          data = data.filter(function (d) { return d.region === "West"})
      	}
      }

    }

    // Filter schools by grade level

    // Select only the schools from the current page (slice)

    var table = document.getElementById('data-table');
    var tbody = table.getElementsByTagName('tbody')[0];
    // Because getElementsByTagName returns an array of DOM nodes (technically, it's an HTMLCollection),
    // we need to select the first item in the array with the [0].

    // Remove any existing rows
    tbody.innerHTML = '';

    // Add a new row for each datum (item in the 'data' array)
    data.forEach(function (d) {
      var row = document.createElement('tr');
      // This is like create a new <tr></tr> in HTML, but it doesn't yet exist in the DOM, so we can't
      // see it. At the bottom of this forEach() loop, we append it to an element that is in the DOM,
      // at which point it appears. We'll follow this same pattern for each of the <td></td> elements
      // we create below.

      var state = document.createElement('td');
      state.innerHTML = d.state;
      row.appendChild(state);  

      var employment = document.createElement('td');
      employment.innerHTML = d.employment;
      row.appendChild(employment);

      var region = document.createElement('td');
      region.innerHTML = d.region;
      row.appendChild(region);

      var barWrapper = document.createElement('td');
      var bar = document.createElement('div');
      bar.setAttribute('class', 'bar');
      // We set the class to 'bar' so we can use the .bar class we have in our styles. This gives it a
      // consistent height and a color.
      var employmentPercentage = d.employment / MAX_EMPLOYMENT;
      bar.setAttribute('style', 'width: ' + (employmentPercentage * 100) + '%;');
      // I've broken this operation up into two steps, which is a little different than we did in class.
      // The end result is the same, though. If 'enrollmentPercentage' equals 0.75, this set the style
      // attribute of our DIV so that it looks something like <div style="width: 75%;"></div>
      barWrapper.appendChild(bar);
      row.appendChild(barWrapper);

      tbody.appendChild(row);
    });
  }

  // The function declaration above just creates the function, it doesn't yet run it. That's what we
  // do here, to make sure that the table is populated prior to the user clicking anything.
  updateTable();

  // This is creating an event listener, a function that the browser will call every time the specified
  // event is "fired" by the selected element (here the button with the id 'sort-asc').
  document.getElementById('sort-asc').addEventListener('click', function () {
    // Disable the sort if 'asc' was previously selected, otherwise set the sort to 'asc'
    if (options.sorted === 'asc') {
      options.sorted = false;
    } else {
      options.sorted = 'asc';
    }

    // And now we need to re-run the function that populates the table. Note that the results will be
    // different because we've change the options object.
    updateTable();
  });

  document.getElementById('sort-desc').addEventListener('click', function () {
    // Disable the sort if 'desc' was previously selected, otherwise set the sort to 'desc'
    if (options.sorted === 'desc') {
      options.sorted = false;
    } else {
      options.sorted = 'desc';
    }

    updateTable();
  });

  // This is where we'll need to create new event listeners for our filter and next/previous page buttons.
  // They'll look very similar to the above, just listening to different elements, and perhaps performing
  // different actions when clicked.

  document.getElementById('filter-ne').addEventListener('click', function () {
    if (options.filtered === 'northeast') {
      options.filtered = false;
    } else {
      options.filtered = 'northeast';
    }
    updateTable();
  });

  document.getElementById('filter-so').addEventListener('click', function () {
    if (options.filtered === 'south') {
      options.filtered = false;
    } else {
      options.filtered = 'south';
    }
    updateTable();
  });

  document.getElementById('filter-mw').addEventListener('click', function () {
    if (options.filtered === 'midwest') {
      options.filtered = false;
    } else {
      options.filtered = 'midwest';
    }
    updateTable();
  });

  document.getElementById('filter-we').addEventListener('click', function () {
    if (options.filtered === 'west') {
      options.filtered = false;
    } else {
      options.filtered = 'west';
    }
    updateTable();
  });


</script>




  <p>Source: <a href="http://www.bls.gov/home.htm">Bureau of Labor Statistics</a></p>
</body>
</html>
