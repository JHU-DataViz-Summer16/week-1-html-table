<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Week 2: JS DOM Tables</title><!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link type="text/css" rel="stylesheet" href="stylesheet.css"/>

</head>

<body>
<div class="header section">
  <div class="container">
    <h1>Week 2: Javascript and the DOM</h1>
    <p>This table shows the total number of employees on nonfarm payrolls by state, in thousands, for March 2016.</p>
  </div>
</div>
<div class="controls section">
  <div class="container">
    <div class="btn-toolbar">
      <div class="btn-group">
        <button type="button" class="btn btn-default" id="sort-asc">Ascending</button>
        <button type="button" class="btn btn-default" id="sort-desc">Descending</button>
      </div>
      <div class="btn-group">
        <button type="button" class="btn btn-default" id="filter-ne">Northeast</button>
        <button type="button" class="btn btn-default" id="filter-so">South</button>
        <button type="button" class="btn btn-default" id="filter-mw">Midwest</button>
        <button type="button" class="btn btn-default" id="filter-we">West</button>
      </div>
    </div>
  </div>
</div>
<div class="main section">
  <div class="container">
    <table class="table" id="data-table">
      <thead>
        <tr>
          <th>State</th>
          <th>Employees (thousands)</th>
          <th>Region</th>
          <th>Chart</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    <nav>
      <ul class="pager">
        <li class="previous"><a href="#" id="page-prev">Previous</a></li>
        <li class="next"><a href="#" id="page-next">Next</a></li>
      </ul>
    </nav>
  </div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script>
  var states = [
	{"state":"Alabama","employment":1959.0,"region":"South"},
	{"state":"Alaska","employment":338.4,"region":"West"},
	{"state":"Arizona","employment":2691.9,"region":"West"},
	{"state":"Arkansas","employment":1224.4,"region":"South"},
	{"state":"California","employment":16321.9,"region":"West"},
	{"state":"Colorado","employment":2595.8,"region":"West"},
	{"state":"Connecticut","employment":1686.3,"region":"Northeast"},
	{"state":"Delaware","employment":458.6,"region":"South"},
	{"state":"District of Columbia","employment":773.8,"region":"South"},
	{"state":"Florida","employment":8252.8,"region":"South"},
	{"state":"Georgia","employment":4360.7,"region":"South"},
	{"state":"Hawaii","employment":651.4,"region":"West"},
	{"state":"Idaho","employment":691.7,"region":"West"},
	{"state":"Illinois","employment":6006.7,"region":"Midwest"},
	{"state":"Indiana","employment":3062.1,"region":"Midwest"},
	{"state":"Iowa","employment":1576.5,"region":"Midwest"},
	{"state":"Kansas","employment":1399.2,"region":"Midwest"},
	{"state":"Kentucky","employment":1908.9,"region":"South"},
	{"state":"Louisiana","employment":1977.1,"region":"South"},
	{"state":"Maine","employment":614.6,"region":"Northeast"},
	{"state":"Maryland","employment":2704.6,"region":"South"},
	{"state":"Massachusetts","employment":3537.1,"region":"Northeast"},
	{"state":"Michigan","employment":4324.9,"region":"Midwest"},
	{"state":"Minnesota","employment":2876.2,"region":"Midwest"},
	{"state":"Mississippi","employment":1147.1,"region":"South"},
	{"state":"Missouri","employment":2801.2,"region":"Midwest"},
	{"state":"Montana","employment":464.6,"region":"West"},
	{"state":"Nebraska","employment":1017.3,"region":"Midwest"},
	{"state":"Nevada","employment":1282.7,"region":"West"},
	{"state":"New Hampshire","employment":664.9,"region":"Northeast"},
	{"state":"New Jersey","employment":4073.9,"region":"Northeast"},
	{"state":"New Mexico","employment":827.6,"region":"West"},
	{"state":"New York","employment":9332.9,"region":"Northeast"},
	{"state":"North Carolina","employment":4310.5,"region":"South"},
	{"state":"North Dakota","employment":440.0,"region":"Midwest"},
	{"state":"Ohio","employment":5491.4,"region":"Midwest"},
	{"state":"Oklahoma","employment":1666.0,"region":"South"},
	{"state":"Oregon","employment":1823.2,"region":"West"},
	{"state":"Pennsylvania","employment":5894.6,"region":"Northeast"},
	{"state":"Rhode Island","employment":490.6,"region":"Northeast"},
	{"state":"South Carolina","employment":2039.6,"region":"South"},
	{"state":"South Dakota","employment":432.3,"region":"Midwest"},
	{"state":"Tennessee","employment":2951.7,"region":"South"},
	{"state":"Texas","employment":11961.6,"region":"South"},
	{"state":"Utah","employment":1411.7,"region":"West"},
	{"state":"Vermont","employment":316.5,"region":"Northeast"},
	{"state":"Virginia","employment":3919.1,"region":"South"},
	{"state":"Washington","employment":3230.5,"region":"West"},
	{"state":"West Virginia","employment":761.8,"region":"South"},
	{"state":"Wisconsin","employment":2936.2,"region":"Midwest"},
	{"state":"Wyoming","employment":284.4,"region":"West"}
  ];

  // The ALL_CAPS treatment here is signalling that this variable is a constant - it should never change.
  var MAX_EMPLOYMENT = 16322;

  var options = {
    sorted: false,
    filtered: false,
    page: 0
  };

  function updateTable() {
    var data = states.slice();

    if (options.sorted) {
      if (options.sorted === 'asc') {
          data.sort(function (a, b) { return a.employment - b.employment; });
        } else if (options.sorted === 'desc') {
          data.sort(function (a, b) { return b.employment - a.employment; });
        }
    }    

//      console.log("message here", options.sorted, options.filtered)

    if (options.filtered) {
    	if (options.filtered === 'northeast') {
    		data = data.filter(function (d) {	return d.region === "Northeast" })
          } else if (options.filtered === 'south') {
            data = data.filter(function (d) { return d.region === "South"})
          } else if (options.filtered === 'midwest') {
            data = data.filter(function (d) { return d.region === "Midwest"})
          } else if (options.filtered === 'west') {
            data = data.filter(function (d) { return d.region === "West"})
     	}
    }

    var table = document.getElementById('data-table');
    var tbody = table.getElementsByTagName('tbody')[0];

    // Remove any existing rows
    tbody.innerHTML = '';

    // Add a new row for each datum (item in the 'data' array)
    data.forEach(function (d) {
      var row = document.createElement('tr');

      var state = document.createElement('td');
      state.innerHTML = d.state;
      row.appendChild(state);  

      var employment = document.createElement('td');
      employment.innerHTML = d.employment;
      row.appendChild(employment);

      var region = document.createElement('td');
      region.innerHTML = d.region;
      row.appendChild(region);

      var barWrapper = document.createElement('td');
      var bar = document.createElement('div');
      bar.setAttribute('class', 'bar');

      var employmentPercentage = d.employment / MAX_EMPLOYMENT;
      bar.setAttribute('style', 'width: ' + (employmentPercentage * 100) + '%;');

      barWrapper.appendChild(bar);
      row.appendChild(barWrapper);

      tbody.appendChild(row);
    });
  }

  updateTable();

  document.getElementById('sort-asc').addEventListener('click', function () {
    if (options.sorted === 'asc') {
      options.sorted = false;
    } else {
      options.sorted = 'asc';
    }

    updateTable();
  });

  document.getElementById('sort-desc').addEventListener('click', function () {
    if (options.sorted === 'desc') {
      options.sorted = false;
    } else {
      options.sorted = 'desc';
    }

    updateTable();
  });

  document.getElementById('filter-ne').addEventListener('click', function () {
    if (options.filtered === 'northeast') {
      options.filtered = false;
    } else {
      options.filtered = 'northeast';
    }
    updateTable();
  });

  document.getElementById('filter-so').addEventListener('click', function () {
    if (options.filtered === 'south') {
      options.filtered = false;
    } else {
      options.filtered = 'south';
    }
    updateTable();
  });

  document.getElementById('filter-mw').addEventListener('click', function () {
    if (options.filtered === 'midwest') {
      options.filtered = false;
    } else {
      options.filtered = 'midwest';
    }
    updateTable();
  });

  document.getElementById('filter-we').addEventListener('click', function () {
    if (options.filtered === 'west') {
      options.filtered = false;
    } else {
      options.filtered = 'west';
    }
    updateTable();
  });


</script>

  <p>Source: <a href="http://www.bls.gov/home.htm">Bureau of Labor Statistics</a></p>
</body>
</html>
